ğŸ¯ Objective Analyze:
Demand trends
Fast-moving products
Slow-moving products
Seasonal demand
Future demand preparation

-- ğŸŸ¢ Stage 1 â€” Demand Analysis
-- âœ… TASK 1 -â“ Monthly Demand per Product
select product_id, date_format(order_date,'%Y-%m') as monthly,
	sum(quantity) as sales
from orders
group by product_id, monthly
order by product_id, monthly;

-- ğŸŸ¢ TASK 2 --â“ Most Demanded Products
select product_id, sum(quantity) as sales
from orders
group by product_id
order by sales  desc;

-- ğŸŸ¢ TASK 3 -â“ Least Demanded Products
select product_id, sum(quantity) as sales
from orders
group by product_id
order by sales;

-- ğŸŸ¢ Stage 2 â€” Trend Analysis
-- âœ… TASK 4 -â“ Running Demand Trend
select order_date, sum(quantity) as daily_demand,
	sum(sum(quantity)) over (order by order_date) as cum_demand
from orders
group by order_date;

-- ğŸŸ¢ TASK 5 - â“ Demand Growth
select order_date, sum(quantity) as demand,
	LAG(sum(quantity)) over (order by order_date) as pre_demand
from orders
group by order_date;

-- ğŸŸ¢ Stage 3 â€” Inventory Thinking
-- âœ… TASK 6 - â“ Fast Moving Products
select product_id, avg(quantity) as avg_sales
from orders
group by product_id
order by avg_sales desc;

-- ğŸŸ¢ TASK 7 -â“ Slow Moving Products
select product_id, avg(quantity) as avg_sales
from orders
group by product_id
order by avg_sales;

-- ğŸŸ¢ Stage 4 â€” Forecast Preparation
-- âœ… TASK 8 - â“ Monthly Trend Table
select date_format(order_date,'%Y-%m') as monthly, sum(quantity) as monthly_sales
from orders
group by monthly;

-- ğŸŸ¢ Stage 5 â€” Advanced Analytics
-- âœ… TASK 9 - â“ Top 5 Growing Products

select * from (
	select o.product_id, sum(o.quantity) as qty, p.product_name,
		dense_rank() over (order by sum(o.quantity) desc) as top_list
	from orders o
    join products p
    on o.product_id=p.product_id
    group by o.product_id) sp
where top_list<=5;




/* ğŸš€ PROJECT 2
ğŸ“¦ Stage 2 â€“ Trend Analysis (Important)
This stage teaches real analyst thinking.
You will learn:
Running totals
Demand changes
Growth patterns
These are used in real companies.

ğŸŸ¢ TASK 1
Running Demand Trend
â“ Question
Show:
order_date
daily demand
cumulative demand */
select order_date, sum(quantity) as daily_demand, 
	sum(sum(quantity)) over (order by order_date) as cum_demand
from orders
group by order_date;

-- ğŸŸ¢ TASK 2 - Demand Growth
/*â“ Question
Show:
order_date
demand
previous demand */
select order_date, sum(quantity) as daily_demand, 
	LAG(sum(quantity)) over (order by order_date) as pre_demand
from orders
group by order_date
order by order_date;

-- ğŸŸ¢ TASK 3 (INTERMEDIATE)
/*  Demand Change %
â“ Question
Show:
order_date
demand
previous demand
growth % */
select order_date, daily_demand, pre_demand,
	round((daily_demand-pre_demand)/pre_demand*100,2) as growth_in_percent from (
	select order_date, sum(quantity) as daily_demand, 
		LAG(sum(quantity)) over (order by order_date) as pre_demand
	from orders
	group by order_date
	order by order_date ) sp ;


/* ğŸŸ¢ TASK 1
Fast-Moving Products
â“ Question - Find products with highest average order quantity. */
select product_id, avg(quantity)
from orders
group by product_id
order by avg(quantity) desc;

-- ğŸŸ¢ TASK 2- Slow-Moving Products
-- â“ Question - Find products with lowest average order quantity.
select product_id,avg(quantity)
from orders
group by product_id
order by avg(quantity);

-- ğŸŸ¢ TASK 3 - Total Quantity Per Product
-- â“ Question - Find total quantity sold per product.
select product_id, sum(quantity) as tot_qty
from orders
group by product_id
order by sum(quantity) desc;

-- ğŸŸ¢ TASK 4 (INTERMEDIATE) - Products Sold Less Than Average
-- â“ Question - Find products sold below average quantity.
select product_id, sum(quantity)
from orders
group by product_id
having sum(quantity) < (
						select avg(total) 
						from (
							select sum(quantity) as total
							from orders
							group by product_id
							) ss
						);
                        
-- ğŸŸ¢ TASK 5 (REAL ANALYST TASK) - Top 5 Fast-Moving Products
-- â“ Question - Find top 5 products by quantity.
select product_id, sum(quantity)
from orders
group by product_id
order by sum(quantity) desc limit 5;


-- ğŸš€ PROJECT 2 - ğŸ“Š Stage 4 â€“ Forecast Preparation (Very Important)
-- ğŸŸ¢ TASK 1 - Monthly Demand Trend
/* â“ Question
Show:
Month
Total Demand */
select date_format(order_date,'%Y-%m') as monthly,
	sum(quantity) as demand
from orders
group by monthly
order by monthly;

-- ğŸŸ¢ TASK 2 - Demand per Product per Month
/* â“ Question
Show:
Product
Month
Demand */
select product_id, date_format(order_date,'%Y-%m') as monthly, 
	sum(quantity) as demand
from orders
group by product_id, monthly
order by product_id, monthly;

-- ğŸŸ¢ TASK 3- Monthly Revenue Trend
/*â“ Question
Show:
Month
Revenue */
select date_format(payment_date,'%Y-%m') as monthly, sum(paid) as revenue
from payments
group by monthly
order by monthly;

-- ğŸŸ¢ TASK 4 (IMPORTANT) - Moving Average
/* â“ Question
Show:
Month
Revenue
3-month average */
select monthly, revenue, 
	avg(revenue) over (order by monthly rows between 2 preceding and current row) as moving_avg
from (
	select date_format(payment_date,'%Y-%m') as monthly, sum(paid) as revenue
	from payments
	group by monthly
	) sm;

-- ğŸŸ¢ TASK 5 (REAL FORECAST TABLE) - Forecast Table
/*â“ Question
Create forecasting dataset.
Show:
Date
Revenue */
select payment_date, sum(paid) as revenue
from payments
group by payment_date;

/* ğŸš€ STAGE 5 â€“ Advanced Supply Chain Analytics
You will learn:
âœ” Supplier analysis
âœ” Warehouse performance
âœ” Delivery performance
âœ” Product analysis */

/* ğŸŸ¢ TASK 1
Top Selling Products
â“ Question-Find top 10 products by quantity sold */
select product_id, sum(quantity)
from orders
group by product_id
order by sum(quantity) desc limit 3;

/* ğŸŸ¢ TASK 2 - Supplier Performance
â“ Question - Find suppliers supplying most products */
select s.supplier_id, count(p.product_id) as tot_prod
from suppliers s
join products p
on s.product_id=p.product_id
group by s.supplier_id
order by tot_prod;

-- ğŸŸ¢ TASK 3 -Warehouse Utilization
-- â“ Question-Find warehouses storing most products
select w.city, count(o.product_id) as tot_prod
from warehouses w
join orders o
on w.warehouse_id=o.warehouse_id
group by w.city;


/* ğŸŸ¢ TASK 4 - Delivery Performance
â“ Question - Find average delivery time per product. */
select o.product_id, avg(datediff(s.delivery_date,s.ship_date)) as avg_delivery_days
from orders o
join shipments s
on o.order_id=s.order_id
where datediff(s.delivery_date,s.ship_date) is not null
group by o.product_id
order by avg_delivery_days desc;

-- ğŸŸ¢ TASK 5 - Delayed Shipments
-- â“ Question - Find delayed shipments (>5 days)
select * 
from (
		select o.product_id, count(*) as delay_orders, avg(datediff(s.delivery_date,s.ship_date)) as avg_delayed_days
		from orders o
		join shipments s
		on o.order_id=s.order_id
		where datediff(s.delivery_date,s.ship_date) is not null
		group by o.product_id
		) d
where avg_delayed_days>5;

-- ğŸŸ¢ TASK 6 (IMPORTANT) - Best Supplier by Sales
-- â“ Question - Find suppliers generating highest sales.
select s.supplier_id, sum(o.quantity) as high_sales
from suppliers s
join prod
join orders o
on s.product_id=o.product_id
group by s.supplier_id
order by high_sales desc;

/* ğŸš€ FINAL CAPSTONE PROJECT
ğŸ“¦ Supply Chain Performance Analytics
ğŸŸ¢ Tables Used
âœ” products
âœ” orders
âœ” shipments
âœ” warehouses
âœ” suppliers */
-- ğŸŸ¢ STEP 1 â€” Total Orders
-- â“ Question - Find total number of orders.
select count(*) as tot_orders
from orders;

-- ğŸŸ¢ STEP 2 â€” Total Quantity Sold
-- â“ Question - Find total quantity sold.
select sum(quantity) as tot_qty  from orders;

-- ğŸŸ¢ STEP 3 â€” Total Products
-- â“ Question - Find total products.
select count(*) as tot_products from products;

-- ğŸŸ¢ STEP 4 â€” Top Products
-- â“ Question - Find top 5 products.
select product_id, sum(quantity) as total
from orders
group by product_id
order by sum(quantity) desc limit 5;

-- ğŸŸ¢ STEP 5 â€” Slow Products
-- â“ Question -- Find slow products.
select product_id, sum(quantity) as total
from orders
group by product_id
order by total limit 5;

-- ğŸŸ¢ STEP 6 â€” Delivery Time
-- â“ Question - Find average delivery time.
select avg(datediff(delivery_date,ship_date)) as avg_delivery_time
from shipments;

-- ğŸŸ¢ STEP 7 â€” Delayed Orders
-- â“ Question - Find delayed orders.
select order_id, datediff(delivery_date, ship_date) as del_days
from shipments
where datediff(delivery_date, ship_date) is not null
group by order_id, del_days
order by del_days desc limit 1;

select order_id, count(*) as delayed_orders from shipments
where datediff(delivery_date,ship_date) > 5
group by order_id;

-- ğŸŸ¢ STEP 8 â€” Supplier Analysis
-- â“ Question - Best supplier.
select supplier_id, count(product_id) as tot_products
from suppliers
group by supplier_id
order by tot_products desc;

-- ğŸŸ¢ STEP 9 â€” Warehouse Analysis
-- â“ Question - Most used warehouse.
select w.city, sum(o.quantity) as tot_qty
from warehouses w
join orders o
on w.warehouse_id=o.warehouse_id
group by w.city;

-- ğŸŸ¢ STEP 10 â€” Monthly Orders
-- â“ Question - Monthly demand.
select date_format(order_date,'%Y-%m') as monthly, sum(quantity) as tot_qty
from orders
group by monthly
order by tot_qty desc;

-- ğŸŸ¢ STEP 11 â€” Delivery Performance
-- â“ Question - Delivery time by product.
select o.product_id, round(avg(datediff(s.delivery_date,s.ship_date)),2) as delivery_time
from orders o
join shipments s
on o.order_id=s.order_id
where datediff(s.delivery_date,s.ship_date) is not null
group by o.product_id
order by delivery_time desc;


-- ğŸŸ¢ STEP 12 â€” Most Delayed Products
-- â“ Question - Most delayed products.
select o.product_id, count(*) as delay_products, avg(datediff(delivery_date,ship_date)) as delay_days
from orders o
join shipments s
on o.order_id=s.order_id
where datediff(delivery_date,ship_date)>5
group by product_id
order by delay_products;


-- Real Business Problems
/* ğŸŸ¢ Task 1 â€” Most Ordered Products
â“ Question - Find products ordered the most number of times.
Hint:
COUNT(*)
GROUP BY */
select product_id, count(*) as tot_ordered_product
from products
group by product_id
order by tot_ordered_product;

-- ğŸŸ¢ Task 2 â€” Average Order Size
-- â“ Question - Find average quantity per order.
select avg(quantity) as avg_qty
from orders;

-- ğŸŸ¢ Task 3 â€” Frequently Delayed Products
-- â“ Question Which products are delayed most?
-- Delay = more than 5 days.
select o.order_id, p.product_name, count(*), avg(datediff(s.delivery_date,s.ship_date)) as delay_days
from orders o
join shipments s
on s.order_id=o.order_id
join products p
on o.product_id=p.product_id
where datediff(s.delivery_date,s.ship_date) > 5
group by o.order_id;

-- ğŸŸ¢ Task 4 â€” Fastest Delivered Products
-- â“ Question - Find products with fastest delivery.
select o.order_id, p.product_name, count(*), avg(datediff(s.delivery_date,s.ship_date)) as fast_delivery
from orders o
join shipments s
on s.order_id=o.order_id
join products p
on o.product_id=p.product_id
where datediff(s.delivery_date,s.ship_date) < 5
group by o.order_id
order by fast_delivery;

-- ğŸŸ¢ Task 5 â€” Supplier With Most Sales
-- â“ Question - Find suppliers with highest sales.
select s.supplier_id, sum(s.supplier_cost*o.quantity) as supplier_high_sales
from suppliers s
join orders o
on s.product_id=o.product_id
group by s.supplier_id
order by supplier_high_sales desc;

-- ğŸŸ¢ Task 6 â€” Warehouse Workload
-- â“ Question - Find warehouses handling most orders.
select w.city, count(*) as most_orders
from warehouses w
join orders o
on w.warehouse_id=o.warehouse_id
group by w.city;

-- ğŸŸ¢ Task 7 (INTERVIEW LEVEL)
-- â“ Question - Find top 3 products per supplier
select * from (
				select s.supplier_id, o.product_id, sum(o.quantity) as tot_qty,
					row_number() over(partition by s.supplier_id order by sum(o.quantity) desc) as rank_no
				from suppliers s
				join products p
				on s.product_id=p.product_id

				join orders o
				on p.product_id=o.product_id
				group by s.supplier_id, o.product_id
                ) t
where rank_no <3;




-- Interview SQL Questions
-- ğŸŸ¢ Question 1 â€” Second Highest Quantity
-- â“ Question - Find the second highest quantity ordered.
select order_id, sum(quantity) as highest_qty
 from orders
 group by order_id
 order by highest_qty desc limit 1 offset 1;
 
 select distinct quantity
 from orders
 order by quantity desc limit 1 offset 1;
 
 -- ğŸŸ¢ Question 2 â€” Products Never Ordered
-- â“ Question - Find products with no orders.
select p.product_id
from products p
left join orders o
on p.product_id=o.product_id
where p.product_id is null;

-- ğŸŸ¢ Question 3 â€” Orders Without Shipment
-- â“ Question - Find orders not shipped.
select o.order_id
from orders o
left join shipments s
on o.order_id=s.order_id
where s.order_id is null;

-- ğŸŸ¢ Question 4 â€” Highest Ordered Product
-- â“ Question - Find product with highest total quantity.
select product_id, sum(quantity) as qty
from orders
group by product_id
order by qty desc;

-- ğŸŸ¢ Question 5 â€” Duplicate Orders
-- â“ Question - Find duplicate orders.
select order_id, count(*) as tot_qty
from orders
group by order_id
having count(*)>1;

-- ğŸŸ¢ Question 6 â€” Monthly Orders
-- â“ Question - Find monthly order count.
select date_format(order_date,'%Y-%m') as monthly, count(*) as order_count
from orders
group by monthly;

-- ğŸŸ¢ Question 7 (IMPORTANT)
-- â“ Question - Find products who ordered more than average.
select product_id, sum(quantity)
    from orders
	group by product_id
    having sum(quantity)>
		(
			select avg(quantity) as avg_qty
			from orders
		 );
         
-- ğŸŸ¢ Question 8 (ADVANCED)
-- â“ Question - Find top 3 products.
select * from (
		select product_id, sum(quantity) as tot_qty,
			row_number() over (order by sum(quantity) desc) as top_rank
		from orders
        group by product_id) t
        where top_rank<4;
